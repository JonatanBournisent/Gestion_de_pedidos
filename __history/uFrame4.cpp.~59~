//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "uFrame4.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TFrame4 *Frame4;
//---------------------------------------------------------------------------
__fastcall TFrame4::TFrame4(TComponent* Owner)
	: TFrame(Owner)
{
}
//---------------------------------------------------------------------------

void TFrame4::restablecerFrame(void)
{
   TIniFile *Configuraciones;
   String Dir = GetCurrentDir()+"//Config.ini";
   Configuraciones = new TIniFile(Dir);

   SQLConnection1->Params->Values["HostName"] = Configuraciones->ReadString("MySQLServer","Servidor", "127.0.0.1");
   SQLConnection1->Params->Values["User_Name"] = "elsembrador";
   SQLConnection1->Params->Values["Password"] = "*-elsembrador63/*";

   delete Configuraciones;

   idSeleccionado = 0;
   ClientDataSet1->Active = false;
   Edit1->Clear();
   ShowScrollBar(DBGrid1->Handle, SB_VERT, true);

   Edit1->SetFocus();
}
//---------------------------------------------------------------------------

void TFrame4::cerrarFrame(void)
{
   ClientDataSet1->Active = false;
   Query1->Close();

   SQLConnection1->Close();
}
//---------------------------------------------------------------------------
void __fastcall TFrame4::Edit1Change(TObject *Sender)
{
   if((Edit1->Text != "" && Edit1->Text.Length() >= 2) || Sender == Label1)
   {
	  ClientDataSet1->Active = false;

	  String q;
//	  q = "SELECT idComida, nombre, codigo, descripcion, dirImagen, "
//		  "(SELECT descripcion FROM categoriacomidas WHERE refCategoriaComida = idCategoriaComida LIMIT 1) AS categoria "
//		  "FROM comidas WHERE (idComida > 1 AND (UPPER(nombre) LIKE :v OR UPPER(codigo) LIKE :v)) ORDER BY nombre LIMIT 10";

      q = "SELECT idComida, nombre, codigo, "
		  "(SELECT descripcion FROM categoriacomidas WHERE refCategoriaComida = idCategoriaComida LIMIT 1) AS categoria "
		  "FROM comidas WHERE (idComida > 1 AND (UPPER(nombre) LIKE :v OR UPPER(codigo) LIKE :v)) ORDER BY nombre LIMIT 15";


	  Query1->Close();
	  Query1->SQL->Clear();
	  Query1->SQL->Add(q);
	  Query1->ParamByName("v")->AsString = "%" + Edit1->Text.UpperCase() + "%";
	  Query1->Open();

	  ClientDataSet1->Active = true;
   }
   else
   {
	  ClientDataSet1->Active = false;
	  Query1->Close();
   }
   ShowScrollBar(DBGrid1->Handle, SB_VERT, true);
}
//---------------------------------------------------------------------------
void __fastcall TFrame4::DBGrid1DblClick(TObject *Sender)
{
   idSeleccionado = ClientDataSet1->FieldByName("idComida")->AsInteger;
}
//---------------------------------------------------------------------------


void __fastcall TFrame4::DBGrid1DrawColumnCell(TObject *Sender, const TRect &Rect,
          int DataCol, TColumn *Column, TGridDrawState State)
{
   if(State.Contains(gdSelected))
   {
	  dynamic_cast <TDBGrid *>(Sender)->Canvas->Font->Color = clWhite;
	  dynamic_cast <TDBGrid *>(Sender)->Canvas->Brush->Color = TColor(0x00C07000);
   }
   else
   {
	  if(dynamic_cast <TDBGrid *>(Sender)->DataSource->DataSet->RecNo % 2)
		 dynamic_cast <TDBGrid *>(Sender)->Canvas->Brush->Color = TColor(0x00D9D9D9);
       else
		 dynamic_cast <TDBGrid *>(Sender)->Canvas->Brush->Color = TColor(0x00F2F2F2);
   }
   dynamic_cast <TDBGrid *>(Sender)->DefaultDrawColumnCell(Rect, DataCol, Column, State);
}
//---------------------------------------------------------------------------

void __fastcall TFrame4::Edit1KeyDown(TObject *Sender, WORD &Key, TShiftState Shift)

{
   if(Key == VK_RETURN)
	  Edit1Change(Label1);
   else if(Key == VK_DOWN)
      DBGrid1->SetFocus();
}
//---------------------------------------------------------------------------

void __fastcall TFrame4::DBGrid1KeyDown(TObject *Sender, WORD &Key, TShiftState Shift)

{
   if(Key == VK_RETURN)
      idSeleccionado = ClientDataSet1->FieldByName("idComida")->AsInteger;
}
//---------------------------------------------------------------------------

